<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Python ICT Lab (IDE)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Skulpt - Client-side Python Interpreter -->
    <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.min.js"></script>

    <style>
        :root {
            --primary-color: #3b82f6; /* Blue for a tech feel */
            --background-dark: #1f2937; /* Dark Gray */
            --code-bg: #111827; /* Very Dark Blue-Gray */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-dark);
        }
        .code-input {
            background-color: var(--code-bg);
            border: 1px solid #4b5563;
            color: #d1d5db; /* Light text */
            min-height: 200px; /* Increased height for better editing */
            white-space: pre-wrap;
            tab-size: 4;
            padding: 0.75rem;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.2s;
        }
        .code-input:focus {
            border-color: var(--primary-color);
        }
        .scrollable-content {
            max-height: 50vh;
            overflow-y: auto;
        }
        .answer-text {
            border-left: 4px solid var(--primary-color);
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen">

    <div id="app" class="max-w-4xl mx-auto space-y-8">
        <!-- Header -->
        <header class="text-center py-4 rounded-lg bg-gray-700 shadow-xl">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-white tracking-tight">
                <i class="fas fa-desktop text-primary-color mr-2"></i> Python IDE Lab
            </h1>
            <p class="text-gray-300 mt-1 text-sm">Interactive Coding & Theory Revision</p>
        </header>

        <!-- Python Code Editor Card (The IDE section) -->
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl border border-gray-700">
            <h2 class="text-2xl font-semibold mb-4 text-primary-color flex items-center">
                <i class="fas fa-code mr-2"></i> Python Code Editor
            </h2>
            <p class="text-gray-300 mb-4">
                Write and execute your Python code below. Use the `print()` function to see output.
            </p>

            <!-- Code Input -->
            <div class="mb-4">
                <label for="codeEditor" class="text-sm font-medium text-gray-400 block mb-1">Your Python Code:</label>
                <textarea id="codeEditor" class="code-input w-full resize-none" spellcheck="false" 
                    data-initial-code="print('Hello, ICT Student!')
# Try defining a function or importing math:
# import math
# print(math.sqrt(16))"></textarea>
            </div>

            <!-- Interaction Area -->
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <button onclick="runCode()" class="w-full sm:w-1/2 bg-primary-color hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-lg">
                    <i class="fas fa-play mr-2"></i> Run Code
                </button>
                <button onclick="resetChallenge()" class="w-full sm:w-1/2 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-lg">
                    <i class="fas fa-undo-alt mr-2"></i> Reset Code
                </button>
            </div>

            <!-- Output/Result Area -->
            <div>
                <label class="text-sm font-medium text-gray-400 block mb-1">Output Console:</label>
                <div id="output" class="p-3 text-sm rounded-lg bg-gray-900 text-gray-200 min-h-[40px] whitespace-pre-wrap">
                    Click 'Run Code' to execute your program.
                </div>
            </div>
        </div>

        <!-- ICT Theory Paper Questions Card -->
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl border border-gray-700">
            <h2 class="text-2xl font-semibold mb-4 text-primary-color flex items-center">
                <i class="fas fa-book-open mr-2"></i> ICT Theory Paper Q&A
            </h2>
            <p class="text-gray-300 mb-4 text-sm">Review common ICT questions related to programming concepts. Click to reveal the official answer and explanation.</p>

            <div id="qaContainer" class="space-y-3 scrollable-content">
                <!-- Q/A Items will be generated here by JS -->
            </div>
        </div>

        <!-- Notification Modal (used instead of alert()) -->
        <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4" onclick="document.getElementById('modal').classList.add('hidden')">
            <div class="bg-white p-6 rounded-lg shadow-2xl max-w-sm w-full" onclick="event.stopPropagation()">
                <h3 id="modalTitle" class="text-xl font-bold mb-3 text-gray-800"></h3>
                <p id="modalMessage" class="text-gray-700 mb-4"></p>
                <button onclick="document.getElementById('modal').classList.add('hidden')" class="w-full bg-primary-color hover:bg-blue-600 text-white font-bold py-2 rounded-lg">
                    Close
                </button>
            </div>
        </div>

    </div>

    <script>
        const editor = document.getElementById('codeEditor');
        const output = document.getElementById('output');
        const qaContainer = document.getElementById('qaContainer');
        const initialCode = editor.dataset.initialCode;

        // --- Core IDE Execution Functions (using Skulpt) ---

        let codeOutput = '';

        // Skulpt's output handler (captures print() statements)
        function outf(text) {
            codeOutput += text;
        }

        // Skulpt's required function for module imports (e.g., import math)
        function builtinRead(x) {
            if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined) {
                // Return generic error for missing file
                throw "Module Not Found: '" + x + "'";
            }
            return Sk.builtinFiles["files"][x];
        }

        // Custom function to display a message in the modal (replaces alert())
        function showModal(title, message) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modal').classList.remove('hidden');
        }

        /**
         * Executes the Python code in the editor using Skulpt.
         */
        async function runCode() {
            const code = editor.value;
            codeOutput = ''; // Clear previous output
            output.textContent = 'Running program...';
            output.className = 'p-3 text-sm rounded-lg bg-gray-900 text-yellow-400 min-h-[40px] whitespace-pre-wrap';

            // Configure Skulpt
            Sk.pre = "output";
            Sk.configure({
                output: outf,
                read: builtinRead,
                // Ensure Python 3 behavior
                __future__: Sk.python3
            });

            try {
                // Execute the Python code asynchronously
                await Sk.misceval.asyncToPromise(function() {
                    return Sk.importMainWithBody("<stdin>", false, code, true);
                });
                
                // Success: Display captured output
                output.textContent = codeOutput || "Program finished successfully (no output).";
                output.className = 'p-3 text-sm rounded-lg bg-gray-900 text-green-400 min-h-[40px] whitespace-pre-wrap';

            } catch (e) {
                // Error: Display the detailed error message
                let errorMsg = e.toString();
                // Clean up Skulpt's error message formatting
                errorMsg = errorMsg.replace(/[(][<]stdin[>][:]/g, 'Line ');
                
                output.textContent = "Error: " + errorMsg;
                output.className = 'p-3 text-sm rounded-lg bg-gray-900 text-red-400 min-h-[40px] whitespace-pre-wrap';
                showModal("Code Error", "Your Python code encountered an error. Check the Output Console for details.");
            }
        }

        function resetChallenge() {
            editor.value = initialCode;
            output.textContent = "Click 'Run Code' to execute your program.";
            output.className = 'p-3 text-sm rounded-lg bg-gray-900 text-gray-200 min-h-[40px] whitespace-pre-wrap';
            showModal("Code Reset", "The editor has been reset to the initial example code.");
        }

        // --- Data and Functions for Q&A Section (Unchanged) ---

        const theoryQuestions = [
            {
                q: "What is an algorithm and why is it important in ICT?",
                a: "An **algorithm** is a finite set of unambiguous instructions performed in a prescribed sequence to achieve a specific goal. It is crucial in ICT because it forms the basis of all computer programs, ensuring that tasks are performed logically and efficiently."
            },
            {
                q: "Explain the difference between a variable and a constant in programming.",
                a: "A **variable** is a storage location paired with a symbolic name whose value can be changed throughout the execution of the program. A **constant** is a value that cannot be altered by the program during its execution. In Python, constants are often represented by naming conventions (e.g., all uppercase like `MAX_SPEED`)."
            },
            {
                q: "Describe the purpose of a 'for' loop and a 'while' loop.",
                a: "A **'for' loop** is typically used for iterating over a sequence (like a list) or when the number of iterations is known beforehand. A **'while' loop** is used to repeatedly execute statements as long as a given condition is true, best used when the number of iterations is unknown and depends on a condition being met."
            },
            {
                q: "What is the role of an interpreter in running Python code?",
                a: "Python uses an **interpreter**. The interpreter reads the code line by line, translating and executing it immediately. This allows for rapid testing and interactive development, unlike a compiler which translates the entire source code before execution."
            },
            {
                q: "What is the purpose of the data type 'Boolean'?",
                a: "The **Boolean** data type represents one of two values: `True` or `False`. It is fundamental for control flow and logic operations in programming (e.g., decision-making using `if` statements), as it controls the flow of execution based on conditions."
            }
        ];

        function toggleAnswer(elementId) {
            const answerElement = document.getElementById('answer-' + elementId);
            const iconElement = document.getElementById('icon-' + elementId);

            if (answerElement.classList.contains('hidden')) {
                answerElement.classList.remove('hidden');
                iconElement.classList.remove('fa-chevron-down');
                iconElement.classList.add('fa-chevron-up');
            } else {
                answerElement.classList.add('hidden');
                iconElement.classList.remove('fa-chevron-up');
                iconElement.classList.add('fa-chevron-down');
            }
        }

        function renderQA() {
            theoryQuestions.forEach((item, index) => {
                const qaItem = document.createElement('div');
                qaItem.className = 'bg-gray-700 rounded-lg shadow-md overflow-hidden';

                qaItem.innerHTML = `
                    <button id="q-${index}" onclick="toggleAnswer(${index})"
                        class="w-full text-left p-4 flex justify-between items-center text-white hover:bg-gray-600 transition duration-150 focus:outline-none">
                        <span class="font-medium text-lg text-gray-200">Q${index + 1}: ${item.q}</span>
                        <i id="icon-${index}" class="fas fa-chevron-down text-primary-color ml-4"></i>
                    </button>
                    <div id="answer-${index}" class="hidden p-4 pt-0">
                        <p class="text-sm answer-text text-gray-300 pl-4 py-2">${item.a}</p>
                    </div>
                `;
                qaContainer.appendChild(qaItem);
            });
        }

        // Initialize the code editor and Q&A section when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            editor.value = initialCode; // Set the initial code hint
            renderQA();
        });
    </script>

</body>
</html>
